# NCToolの使い方

このツールは、プリント基板エディタのPCBEで設計したデータを使用して、中華CNCでプリント基板やケース加工を行うためのツールです。
PCBEはもともとプリント基板作成用のツールですが、機械加工を行う簡易CADとして利用でき、プラスチックケースやアクリル、薄い金属素材の加工に使用できます。
また、レーザーユニットを使用することで、レーザーカット、レーザー彫刻を行うことも可能です。

※このソフトは.NET4.7.2を使用しています。.NETランタイムが必要になります。

ダウンロードサイト
https://dotnet.microsoft.com/download/dotnet-framework/net472

### ソースから実行ファイルを作成する場合

VisualStudio2019を使用しています。

展開したディレクトリのNCTool.slnをVS2019で開いてください。ビルドを行うと実行ファイルができます。

## ●おことわり

本ツールは、自身の目的で、自身の環境のために作成したもので、特定の環境、特定のデータでのみ動作を確認しています。
このため、異なる機材、環境、デザインデータで正しく機能することは保証するものではありません。
ご自身の責任において、使用するかしないかの判断をお願いします。
使用する場合は、必要な保安処置、適切な使用方法により、ご利用ください。
また、本ツールを使用したことによる、いかなる被害、損害、問題ついて当方では一切保証いたしません。

本ツールはMITライセンスで公開します。
改変は自由ですが、オリジナルのCopyright表示は残してください。使用は自己責任でお願いいたします。

## ●加工可能な材質

次のようなものが加工可能です。

・プリント基板（紙エポキシ、ガラスエポキシ、0.5mm～3mm厚程度）

・MDF板（～5mm程度、レーザーの場合は～2mm程度）

・木材（5mm程度）

・アクリル板（～5mm程度、レーザーの場合は～2mm程度の黒のみ）

・アルミ板（～2mm程度）

その他、5mm程度までの板状の素材は対応可能なものがあります。（発泡スチロールなどの不適な素材もあります）

それぞれ、適した加工パラメータや、冷却方法などの加工に適した手順があります。

## ●準備

本ツールはPCBEが出力するガバーデータを入力としますので、PCBEが必要です。
※PCBE以外のガバーデータでは一切テストをしていませんので、動作するかは不明です。
PCBEは、次のURLからダウンロードして、ご自身の環境に合わせてインストールしてください。

https://www.vector.co.jp/soft/winnt/business/se056371.html

本ツールは、インストールは必要ありません。
ZIPファイルを展開して、そのファイルを適当な場所に保存してください。（Releaseの下に実行ファイルがあります）
exeファイルのショートカットをディスクトップに作っておくと起動が容易です。

実際の加工には、GRBL0.9または1.1を搭載したNCツールを使用します。
GRBLはCNC加工のためのオープンソースプログラムです。
これを搭載したCNCや3Dプリンタが多く販売されています。

https://github.com/grbl/grbl/wiki

また、CNCによっては、レーザー光源がオプションで使えるものがあり、本ツールはレーザー使用にも対応しています。

対応するCNCの一例（すべて動作するかはわかりません。GRBLが使用されていることを目安にしてください）

https://www.amazon.co.jp/s?k=CNC&__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&ref=nb_sb_noss_2

他にもgrblを搭載したCNCは、利用できる可能性があります。

## ●作成物の設計

PCBEを使用して、作成したいものの設計を行います。
NCToolでは、PCBEの出力するガバーデータ（プリント基板作成用のデータ）の内、穴レイヤーと外形レイヤーを使用します。
PCBEのそれぞれのレイヤーで設計データを作成します。

使用できる図形は、線、穴、円弧、文字（英字、数字のみ）です。

プリント基板を作成する場合は、穴レイヤーに部品の取付穴、はんだ付け用の穴などを配置し、外形レイヤーにプリント基板の外形を設計します。

ケース加工などの場合は、穴レイヤーに穴あけのデータを配置し、外形レイヤーに切り出す外形線を作成します。市販ケースなど、切り出しが不要の場合は、外形レイヤーを使わなくても問題ありません。

## ●ガバーデータ出力

設計が出来たら、ガバーデータ出力を行います。
穴レイヤーと外形レイヤーのみが必要です。(他のレイヤーを使って加工することも可能です)

## ●出力方法

・CNCの準備

CNCの電源を入れ、USBでパソコンに接続します。
デバイスマネージャーで、シリアルポートの番号を調べておきます。

・素材の固定

CNCの作業台に素材を固定します。
CNCに付属の金具や、両面テープ、ガムテープなどを使用して固定します。切削の場合は、ある程度力がかかりますので、しっかり固定する必要があります。

・加工作業

NCToolを起動します。
左上のシリアルポートの選択から、CNCのシリアルポートを選択して、「Connect」ボタンを押します。

切削条件パラメータを設定します。

ガバーデータのファイルを指定します。

ファイル読み込みを行います。エラーが発生しなければ、Excecuteボタンが有効になります。

「Excecute」ボタンを押します。

ツールごとに実行するか確認のダイアログが出ますので、実行したいツールを選択してください。
選択後、「Resume」ボタンで実際の切削が始まります。
緊急で停止したい場合は「Abort」ボタンを押してください。このボタンを使用すると、CNCがロックしますので、一旦電源を切って、NCToolも再起動してください。この場合、加工の継続は出来ませんので、ご注意ください。

## ●画面説明

・シリアルポート選択
シリアルポートの一覧です。CNCが接続されているシリアルポートを選択します。

・シリアルポートオープン・クローズボタン
シリアルポートを選択したら、オープンボタンを押します。オープンすると「クローズ」と表示が変わります。

・応答表示
CNCからの応答が表示されます。

・手動コマンド入力・送信ボタン
コマンドをCNCへ直接送ることが出来ます。コマンドを入力して送信ボタンを押します。
この機能は、レーザーを使用するときに焦点調整をする場合に使用します。

・手動ドリル入力・ボタン
穴あけを手動で行うことが出来ます。X,Y,φ（直径）を入力してDrilボタンを押します。
加工条件は右側の各数値によります。

・X，Y現在位置表示、原点設定ボタン
CNCから送られてきた現在位置を表示します。位置を移動してHOMEボタンを押すと、その場所が0,0点になります。
但し、grbl1.1では表示は0,0にはなりません。

・X,Y移動ボタン（上下左右、ホーム）
ツール位置を前後左右に移動することが出来ます。1回に移動する量は下のプルダウンで選択します。
ホームを押すと、現在設定されているHOME位置へ移動します。

・X,Y移動量選択
XY移動ボタンを押したときの移動量を選択します。

・Z現在位置表示、原点設定ボタン
Z（上下）方向のCNCから送られてきた現在位置を表示します。HOMEボタンを押すと今の位置が0点となります。

・Z移動ボタン（上下）
Z軸の移動を行います。移動量は下のプルダウンで選択します。

・移動量選択
Z軸の移動量を選択します。

・素材選択
設定ファイルに設定された素材が選択できます。素材を選択すると、設定ファイルの対応する加工速度、加工ステップも変化します。

・素材厚さ選択
加工する素材の厚さを入力します。切削の場合は、この厚さを加工ステップで割った数に分割して加工が行われます。

・加工速度指定
加工の際のツールの移動速度を指定します。素材や加工ステップ、ツールの回転数（レーザー光の強さ）により調整します。

・加工ステップ指定
1回に加工する厚さを指定します。素材が2.0mmで、加工ステップが0.1mmの場合は20回0.1mmづつ加工していきます。
一般に硬い素材は1回のステップを少なくする必要があります。不適切だと、ツールが破損したり、加工面が荒れたりします。

・加工オフセット（X,Y）
入力データの原点からのオフセットを入力します。設計したデータの一番XYの小さい点を指定すると、その位置がツールの原点として加工が行われます。

・回転速度（レーザーの場合は光量）
スピンドルモーターの回転数（実際はPWMの値）、または、レーザーの光量（0-1000で指定）を設定します。
素材、厚さ、速度、ステップの組み合わせで、適した速度を決める必要があります。

・X,Y入れ替え
入力データのXYを入れ替えて加工します。これにより鏡像で90度回転した出力になります。

・テストモード
加工の状況をシミュレートする機能です。実際にツールの移動を行いますが、切削（レーザーON）を行いません。

・レーザーモード
チェックするとレーザーモードとなります。チェックしていないと切削モードで、加工を開始するとスピンドルが回転したままになります。
レーザーモードの場合は、実際の切削の開始終了似合わせてレーザー光がON/OFFします。
レーザーモードの場合は、すべての円と0.1を超える線幅の線は周囲加工になります。
1mmの幅の線の場合、1mm間隔の2本の線と、両端に半径0.5mmの半円の加工に展開されます。

・実行ボタン
加工を始める際に押します。加工データを読み込んでいないと押すことが出来ません。

・継続ボタン
ツールを選択して、実際に加工を行う際に押します。

・緊急停止ボタン
設定の問題や、危険があった場合に直ちに停止したい場合に押します。
このボタンを押すと以降そのまま継続することが出来ません。プログラムをいったん終了して、CNCの電源も入れ直してください。

・ファイル読み込み
指定した入力ファイルを読み込みます。読み込みでエラーが有るとポップアップで表示されます。
次の入力ファイルで選択を行わないと押すことが出来ません。

・入力ファイル名、ファイル選択ボタン
加工にしようするガバーデータファイルを指定します。

・著作権表示
この部分をクリックすると、バージョンが表示されます。

## ●設定ファイル

プログラムの動作に必要な設定はNCTool.iniファイルから読み込みます。このファイルは、実行ファイルと同じディレクトリにあるものが読み込まれます。
このファイルはテキストファイルです。テキストエディタで編集してください。（漢字コードはSJIS）
ファイル例です。

```
[material]
1=MDF
2=木
3=アクリル
4=アルミ
5=プリント基板

[speed]
1=500
2=300
3=300
4=200
5=400

[step]
1=0.5
2=0.3
3=0.2
4=0.1
5=0.2

[workarea]
x=220
y=160

[setup]
spindle=500
speed=400
step=0.2
thickness=2.0
```

[～]で囲まれた部分は設定のグループです。

[material]は素材選択に表示する素材名です。番号は20まで使用可能です。（最大20の素材を設定できます）

[speed]、[step]は素材に対応した加工速度と加工ステップ数の設定です。素材と番号を一致させてください。

[workarea]は、加工可能な最大サイズです。X,Y位置がこの値を超える場合は、加工が行われません。

[setup]はその他の設定値で次の内容です。

spindleは回転速度（レーザーの場合は光量）の初期値です。

speedは加工速度の初期値です。

stepは、加工ステップの初期値です。

thicknessは、素材厚の初期値です。

## ●ログファイル

実行ファイルと同じディレクトリにログファイルが出力されます。
ログファイル名は、NCToolを起動した年月日日時秒です。
ログファイルの出力は、CNCへ送信したG-Codeデータと、入力のG-Codeや処理内容がコメントとして出力されます。
加工結果がおかしい場合は、このファイルで原因を調査することが出来ます。

## ●その他

・pcbeのアパチャーの「角ライン」には対応していません。（線の端を丸ではなく四角にする）

## ●注意

・切削はかなり大きな音が出る場合がありますので、加工する環境や時間に注意が必要です。

・切削屑が飛び散る場合がありますので、保護メガネやマスクを必要に応じて使用してください。

・設定ミスや設計データの誤りにより、ツールが折れて飛ぶ場合があります。周りの環境や目の保護を行ってください。

・ツールやモーターは高速で回転しています。衣類や髪の毛が巻き込まれないようにご注意ください。

・ヘッドやテーブルが移動します。動作前には周囲の環境を確認してください。

・レーザーの場合は、直接見ると目に悪影響がありますので、専用の保護メガネを使用してください。

・レーザーの場合は、高熱が発生して、素材が燃えやすいものの場合、発火する可能性がありますので、加工中はそばを離れないようにしてください。また、念の為消火用の水や消化器の準備をしておいてください。

・本ソフトの対象としているCNCや本ソフトは、安全対策が十分とは言えません。使用にあたっては、上記内容を含めて十分ご注意ください。
使用したことにより、損害や被害が発生した場合でも、一切保証出来ませんので、ご自身の責任で、安全に留意してご利用ください。

## ●FAQ

・シリアルポートが選択肢に無い

一旦NCToolを閉じて、再起動してみてください。
デバイスマネージャーで、CNCを接続する前と後で、増えたシリアルポートがあるか確認してください。
場合によっては、デバイスドライバーが必要な場合があります。CNCの説明に従ってデバイスとライバーのインストールをしてください。

・ファイルを読み込むとプログラムが異常終了する

読み込ませているファイルが正しいか確認してください。
どうしてもうまくゆかない場合は、そのファイルをお送りください。

・実行中にエラーが発生する

読み込ませたファイルと実行ファイルのディレクトリに作成されるログファイル（年月日時分秒のファイル）をお送りください。

・Excecuteボタンが押せない

加工用のファイルを読み込まないとExcecuteボタンは押せません。また、読み込みでエラーが発生するとボタンは有効になりません。

・加工位置がずれる

設計データの基準点が正しくあっていない可能性があります。基準点の位置が、ツールのホームポジションに合っているか確認してください。
また、設計時にX0,Y0点以外が基準の場合は、オフセットを設定してください。

・素材選択が表示されない

設定ファイル（NCTool.ini）が存在していない可能性があります。実行ファイルのディレクトリを確認してください。存在しない場合は、配布ファイルに含まれているファイルをコピーしてください。

## ●加工条件のノウハウ

ツールの回転速度、移動速度、加工回数のパラメータは、材質や加工目的で最適な値があります。
ご利用CNCによっても最適値は変わる可能性があります。
まずは、充分テストを行って、使用する素材に適した値を見つけてください。
また、プラスチックやアクリルの熱で溶ける素材の場合、工具に付着して、加工が汚くなったり、ツールや素材を破損したりする場合があります。水や油をかけて冷却しながら加工するとうまくゆく場合もあります。

レーザー加工の場合は、移動速度を遅めにしてステップ数を少なくしたほうが良い結果になります。（レーザー光量、移動速度、照射回数のバランスが最適に成るように加工を行う）
これは、移動開始や停止部分は遅くなるため、その部分だけ余計にレーザーが当たることになり、余計に焼けたり切断されるためです。移動速度が遅いと、この差が比較的少なくなり、結果も良好になります。

その他、加工のノウハウや実例は、NCToolのホームページやYouTubeで公開を予定しています。

### プリント基板加工の例
https://youtu.be/lhH6UW_FHz0

### 皮革レーザー加工の例
https://youtu.be/q0qxkIIjZgE

### アクリル板レーザー加工の例
https://youtu.be/3Zfp7D-jRYk

### アクリル板切削加工の例
https://youtu.be/3z307GCU7QA

### MDF版加工の例
https://youtu.be/kPWUrSsdfss
